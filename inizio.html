<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ping Pong Live - Partite</title>
    <style>
        /* Stili semplici e facili da modificare */
        body { margin: 0; font-family: Arial, Helvetica, sans-serif; background: #111; color: #f5f5f5; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        h1 { margin: 0 0 8px; font-size: 22px; }
        .subtitle { color: #bdbdbd; font-size: 13px; margin-bottom: 16px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 12px; }
        .card { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 10px; padding: 12px; }
        .row { display: flex; align-items: center; justify-content: space-between; margin: 6px 0; }
        .names { width: 100%; }
        .player { display: flex; align-items: center; justify-content: space-between; }
        .name { font-weight: 600; }
        .sets { font-weight: 800; }
        .meta { color: #bdbdbd; font-size: 12px; }
        .badge { font-size: 11px; text-transform: uppercase; padding: 3px 8px; border-radius: 999px; border: 1px solid #333; }
        .badge.live { background: #3a1e22; color: #ff6b6b; border-color: #ff6b6b; }
        .badge.programmato { background: #1c2a3a; color: #6ab0ff; border-color: #6ab0ff; }
        .badge.terminato { background: #202728; color: #a0b3ba; border-color: #a0b3ba; }
        .btn { background: #00d4ff; color: #00111a; border: none; padding: 8px 10px; border-radius: 8px; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>
<div class="container">
    <h1>Ping Pong Live</h1>
    <div class="subtitle">Elenco partite (live, programmate, terminate)</div>

    <!-- Le card delle partite compariranno qui sotto -->
    <div id="matches-container" class="grid"></div>
</div>

<script>
    // Connessione WebSocket al server (porta 8888)
    const ws = new WebSocket('ws://localhost:8888/ws');

    // Dizionario con i dati delle partite: { matchId: dati }
    const matches = {};

    // Ogni messaggio aggiorna/aggiunge una partita e ridisegna la lista
    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        matches[data.matchId] = data;
        render();
    };

    ws.onerror = (e) => console.error('Errore WebSocket', e);

    // Disegna le card in pagina in modo semplice
    function render() {
        const container = document.getElementById('matches-container');
        container.innerHTML = '';

        // Ordinamento semplice per stato: live -> programmato -> terminato
        const order = { live: 1, programmato: 2, terminato: 3 };
        const list = Object.entries(matches).sort((a, b) => order[a[1].stato] - order[b[1].stato]);

        list.forEach(([matchId, m]) => {
            const card = document.createElement('div');
            card.className = 'card';

            const scheduled = m.scheduledAt ? `Inizio: <strong>${m.scheduledAt}</strong>` : '';
            const durationLabel = m.stato === 'programmato' ? 'Durata prevista' : 'Durata';
            const time = m.time || '00:00:00';

            card.innerHTML = `
                <div class="row">
                    <span class="badge ${m.stato}">${m.stato}</span>
                    <button class="btn" onclick="window.location.href='info.html?match=${matchId}'">Dettagli</button>
                </div>
                <div class="row">
                    <div class="names">
                        <div class="player"><span class="name">${m.player1 || ''}</span><span class="sets">${m.setsP1 ?? 0}</span></div>
                        <div class="player"><span class="name">${m.player2 || ''}</span><span class="sets">${m.setsP2 ?? 0}</span></div>
                    </div>
                </div>
                <div class="row">
                    <div class="meta">${scheduled}</div>
                    <div class="meta">${durationLabel}: <strong>${time}</strong></div>
                </div>
            `;

            container.appendChild(card);
        });
    }
</script>
</body>
</html>